name: Split csv file
description: Split CSV file in several files with same number of rows (except the last one)
metadata:
  annotations:
    author: Joaquín Barceló <jbarceló@solver.cl>
    canonical_location: https://raw.githubusercontent.com/juacobarcelo/kubeflow-pipelines-components-and-images/main/componentes-generales/split-csv-into-multiple-files/component.yaml
inputs:
- name: archivo-entrada
- name: number-of-lines-to-skip
  default: '0'
outputs:
- name: archivos-salida-comprimidos
implementation:
  container:
    image: alpine
    command:
    - sh
    - -exc
    - |
        apk add wget bash coreutils
        mkdir -p trabajo
        cd trabajo
        wget https://raw.githubusercontent.com/juacobarcelo/kubeflow-pipelines-components-and-images/main/componentes-generales/split-csv-into-multiple-files/split-csv-into-multiple-files.sh
        chmod 755 split-csv-into-multiple-files.sh
        echo "-----> Param:"
        echo "entrada: $0"
        ls "$0"
        echo "Lines to skip: $1"
        echo "Archivo salida $2"
        bash -x ./split-csv-into-multiple-files.sh "$0" -d salida -s "$1" -p data_ 
        cd salida
        echo "----------> Archivos (splitted):"
        ls -la
        echo "Creo directorio destino"
        dirname $2 |  xargs mkdir -p
        echo "----------> Tar:"
        (tar -cvzf "$2" *csv)
        echo "----------> ls Archivo tar:"
        ls -la $2
        echo "----------> Contenido Archivo tar:"
        tar -tvf $2
    - inputPath: archivo-entrada
    - inputValue: number-of-lines-to-skip
    - outputPath: archivos-salida-comprimidos
    
